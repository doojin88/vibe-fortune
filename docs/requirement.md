# 요구사항 정의서

## 1. 프로젝트 개요

### 1.1 목적
AI 기반 사주 분석 서비스를 구독 모델로 제공

### 1.2 핵심 가치
- 간편한 Google 로그인
- 무료/유료 구독을 통한 차등화된 서비스
- AI 기반 고급 사주팔자 분석
- 편리한 자동 결제 시스템

### 1.3 기술 스택
- 프레임워크: Next.js 15
- 인증: Clerk (Google OAuth)
- 데이터베이스: Supabase
- 결제: 토스페이먼츠
- AI: Google Gemini API

---

## 2. 페이지 구성

| 페이지 | 접근 권한 | 설명 |
|--------|-----------|------|
| 홈 (랜딩) | 누구나 | 서비스 소개 및 회원가입 유도 |
| 대시보드 | 로그인 필요 | 사용자의 분석 이력 조회 |
| 새 분석하기 | 로그인 필요 | 사주 정보 입력 |
| 분석 상세 | 로그인 필요 | 분석 결과 확인 |
| 구독 관리 | 로그인 필요 | 구독 상태 확인 및 관리 |

---

## 3. 기능 요구사항

### 3.1 사용자 인증

#### Google 로그인
- Google 계정으로 간편 로그인
- 회원가입/로그인/로그아웃 기능

#### 사용자 정보 관리
- 로그인 시 사용자 정보 자동 동기화
- 사용자별 분석 이력 및 구독 정보 관리

---

### 3.2 사주 분석 기능

#### 입력 정보
- 성함
- 생년월일
- 출생시간 (선택)
- 성별

#### 분석 결과
- 천간(天干)과 지지(地支)
- 오행(五行) 분석
- 대운(大運)과 세운(歲運)
- 성격, 재운, 건강운, 연애운 종합 분석

#### 등급별 서비스
| 구분 | 이용 횟수 | AI 모델 | 분석 품질 |
|------|-----------|---------|-----------|
| 무료 | 최초 3회 | Flash | 기본 분석 |
| Pro | 월 10회 | Pro | 고급 분석 |

---

### 3.3 구독 및 결제

#### 구독 플랜
- **무료**: 최초 3회 제공
- **Pro**: 월 9,900원, 월 10회 고급 분석 제공

#### 구독 가입 절차
1. 구독 관리 페이지에서 Pro 구독 신청
2. 카드 정보 입력 및 인증
3. 최초 결제 (9,900원) 즉시 실행
4. Pro 활성화 및 분석 횟수 10회 지급

#### 구독 상태
- **활성 (Active)**: 정상 이용 중
- **취소 예정 (Cancellation Pending)**: 다음 결제일까지 혜택 유지
- **만료 (Expired)**: 구독 종료
- **실패 (Failed)**: 결제 실패로 자동 해지

#### 구독 취소 및 재가입
- 언제든 취소 가능, 다음 결제일까지 혜택 유지
- 취소 예정 상태에서 철회 가능
- 재가입 시 카드 정보 재등록 필요

#### 자동 결제
- 매일 새벽 2시 자동 실행
- 결제일 도래 구독 자동 처리
- 결제 성공: 분석 횟수 10회 추가, 구독 기간 1개월 연장
- 결제 실패: 즉시 해지 처리

---

## 4. 비기능 요구사항

### 4.1 보안
- 사용자 인증 필수 (홈 페이지 제외)
- 결제 정보 암호화 저장
- API 요청 검증

### 4.2 성능
- 분석 결과 생성 시간 최소화
- 대시보드 빠른 로딩

### 4.3 확장성
- 향후 다양한 구독 플랜 추가 가능
- AI 모델 교체 용이

---

## 5. 성공 지표

### 5.1 필수 기능
- [ ] Google 로그인
- [ ] 사용자 정보 자동 동기화
- [ ] 사주 분석 생성 및 조회
- [ ] 무료 3회 / Pro 월 10회 제한
- [ ] 빌링키 기반 자동 결제
- [ ] 구독 취소 및 재가입

### 5.2 구독 정책
- [ ] 무료 사용자는 기본 AI 모델 사용
- [ ] Pro 구독자는 고급 AI 모델 사용
- [ ] 구독 취소 시 다음 결제일까지 혜택 유지
- [ ] 취소 예정 중 철회 가능
- [ ] 결제 실패 시 즉시 해지
- [ ] 재구독 시 카드 재등록

### 5.3 자동화
- [ ] 매일 자동 결제 처리
- [ ] 결제 성공 시 자동 갱신
- [ ] 결제 실패 시 자동 해지

---

## 6. 참고 자료

- [Clerk 공식 문서](https://clerk.com/docs)
- [토스페이먼츠 개발자 센터](https://docs.tosspayments.com/)
- [Gemini API 문서](https://ai.google.dev/docs)
- [Supabase 문서](https://supabase.com/docs)
