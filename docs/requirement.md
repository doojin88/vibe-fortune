# 요구사항 정의서

## 1. 프로젝트 개요

- AI 기반 사주 분석 서비스를 제공

---

## 2. 페이지 개요 

**인증 개요**

- 홈 이외의 페이지는 인증 상태로만 접근 가능합니다.
- 인증관련 페이지는 모두 Clerk SDK에서 기본적으로 제공되는 것을 사용합니다.

**페이지 목록**

- 홈 (랜딩 페이지)
- 대시보드
- 새 분석하기
- 사주분석 상세
- 구독 관리

**페이지 구성**

- 홈 (랜딩페이지): header(서비스명,메뉴,CTA), hero(소개문구,CTA,이미지), features(주요기능3가지), pricing, faq, footer
- 대시보드 (분석목록): 상단 페이지 제목 및 설명, 검색바(검사자 이름으로 검색가능), 검사내역 (3 column grid card)
- 새 검사: 상단 페이지 제목 및 설명, form(이름, 생년월일, 출생시간-시분초(모름 체크가능), 성별), 검사시작 버튼
- 분석 상세보기: 상단 페이지 제목 및 설명, 입력된 검사 정보, 분석결과(text)
- 구독 관리: 현재 구독 정보 + 구독 상태에 따른 적절한 action 버튼

**공용 레이아웃**

홈 이외의 페이지는 다음 공용 레이아웃을 가집니다.

- header: 서비스명(클릭시 대시보드 페이지로 이동), 메뉴(대시보드, 구독관리), 프로필(아바타, 드롭다운메뉴)
- sidebar: 메뉴('대시보드', '새 검사'), 하단에 구독상태표시(이메일, 잔여검사횟수, 요금제, 다음결제일)

**검사 플로우**:

1. 사용자가 '새 검사' 페이지에 진입한다.
2. 사용자가 검사 정보를 입력하고 '검사시작' 버튼을 클릭한다.
3. 서버에서 해당 사용자의 잔여 검사 횟수를 확인한다.
   - 잔여 검사 횟수가 0인 경우, 사용자에게 구독 페이지로 이동하라는 메시지를 표시한다.
   - 잔여 검사 횟수가 1회 이상인 경우, 다음 단계로 진행한다.
4. 서버에서 Gemini API를 호출하여 사주 분석을 수행한다.
5. 분석이 진행되는 동안 dialog를 표시하고, 완성중인 결과를 실시간으로 streaming하여 보여준다.
6. 분석이 완료되면 제출된 검사정보와 함께 데이터베이스에 저장하고, 완료되었음을 사용자에게 alert로 알린다.
7. 사용자가 alert의 확인 버튼을 누르면, 사용자를 분석 상세보기 페이지로 리다이렉트한다.

**구독 정책**:

- 무료 가입 유저는 최초 3회만 테스트 가능합니다. (`gemini-2.5-flash` 사용)
- Pro 요금제 구독 고객은 월 10회 테스트 가능합니다. (`gemini-2.5-pro` 사용)
- Pro 요금제 취소 시, 다음 결제일까지 구독 상태가 유지됩니다.
- Pro 요금제 취소 시, 다음 결제일전에 취소상태를 취소할 수 있습니다.
- 구독 해지와 동시에 빌링키를 삭제합니다. 다시 구독하려면 SDK를 통한 재발급이 필요합니다.
---

## 3. 페이지 상세

### 3.1 홈 ('/', 랜딩 페이지)

**접근 권한**: 누구나

**화면 구성**:

- 헤더: 로고, 앵커메뉴(홈, 서비스, 가격, FAQ), 사용자메뉴(로그인 여부에 따라 시작하기 or 이용하기)
- '시작하기', '이용하기' 버튼 클릭 시 대시보드 페이지로 이동
- 다음 섹션 존재: hero, features, pricing, faq

### 3.2 대시보드

**접근 권한**: 로그인 필요

**화면 구성**:

- 헤더: 로고, 메뉴(대시보드, 새 검사), 사용자 프로필 버튼
- 메뉴 : 대시보드, 새 검사
- 컨텐츠
  - 과거 사주분석 이력 목록 (날짜, 이름, 미리보기)
  - "새 검사하기" 버튼


### 3.3 새 검사하기

**접근 권한**: 로그인 필요

**화면 구성**:

- 입력 폼
  - 성함 (필수)
  - 생년월일 (필수, YYYY-MM-DD 포맷, 날짜 입력 또는 선택)
  - 출생시간 (선택, HH:MI 포맷,  시간 입력 또는 선택, "출생시간모름" 선택가능)
  - 성별 (필수, 남성/여성 선택)
- "검사 시작" 버튼

**사용자 인터랙션**:
- 필수 항목 미입력 시 → 제출 버튼 비활성화
- 검사 시작 버튼 클릭 → 로딩 표시 후 AI 사주분석 진행
- 사주분석 완료 → 사주분석 상세 페이지로 자동 이동

### 3.4 사주분석 상세
**접근 권한**: 로그인 필요 (본인 사주분석만 조회 가능)

**화면 구성**:
- 사주분석 대상 정보 (이름, 생년월일, 출생시간, 성별)
- 사주분석 결과 (마크다운 렌더링)
  - 천간과 지지
  - 오행 분석
  - 대운과 세운
  - 성격, 재운, 건강운, 연애운
- "목록으로" 버튼
- "새 검사하기" 버튼

**사용자 인터랙션**:

- 목록으로 버튼 클릭 → 대시보드로 이동
- 새 검사하기 버튼 클릭 → 새 검사하기 페이지로 이동
- 사주분석 결과 복사 가능

### 3.5 구독관리 상세
**접근 권한**: 로그인 필요

**화면 구성**:
- 현재 구독 상태 표시
  - 이메일 주소
  - 현재 요금제 (무료/Pro)
  - 잔여 검사 횟수
  - 다음 결제일 (Pro 구독자의 경우)
- 구독 상태에 따른 액션 버튼
  - 무료 사용자: "Pro 구독하기" 버튼
  - Pro 구독자: "구독 취소" 버튼
  - 구독 취소된 사용자: "구독 재개" 버튼

**사용자 인터랙션**:
- Pro 구독하기 버튼 클릭 → 토스페이먼츠 결제 페이지로 이동
- 구독 취소 버튼 클릭 → 구독 취소 확인 후 다음 결제일까지 구독 상태 유지
- 구독 재개 버튼 클릭 → 구독 재개 처리
- 구독 상태 변경 시 실시간으로 화면 업데이트

---

## 4. 기능 요구사항

- clerk 를 이용한 사용자 인증
- gemini 를 활용한 AI 사주분석 제공 
- 구독 관리는 제공하지 않는다.
