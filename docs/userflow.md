# Userflow 명세서

## 목차
1. [사용자 타입별 Userflow](#1-사용자-타입별-userflow)
2. [회원가입/로그인 플로우](#2-회원가입로그인-플로우)
3. [새 사주분석 요청 플로우](#3-새-사주분석-요청-플로우)
4. [사주분석 이력 조회 플로우](#4-사주분석-이력-조회-플로우)
5. [사주분석 상세 조회 플로우](#5-사주분석-상세-조회-플로우)
6. [예외 상황 및 에러 처리](#6-예외-상황-및-에러-처리)

---

## 1. 사용자 타입별 Userflow

### 1.1 신규 사용자 (미가입)

#### 입력
- 홈페이지 접속
- Hero 섹션 탐색
- 시작하기 버튼 클릭

#### 처리
1. 사용자가 시작하기 버튼 클릭
2. 시스템이 인증 상태 확인
3. 비로그인 상태 감지
4. Clerk 로그인 페이지로 리다이렉트
5. 사용자가 Google 계정 선택
6. Google OAuth 인증 프로세스 진행
7. Clerk가 JWT 토큰 생성
8. Clerk Webhook이 user.created 이벤트 발행
9. 서버가 Webhook 수신
10. Supabase users 테이블에 신규 레코드 생성
11. 인증 완료 후 대시보드로 리다이렉트

#### 출력
- Clerk 로그인 페이지 표시
- 로그인 성공 시 대시보드로 이동
- 빈 상태 화면 표시
- 첫 검사 시작하기 버튼 제공

#### 엣지케이스
- Google OAuth 인증 취소: 홈페이지로 리턴
- Google 계정 없음: OAuth 프로세스 중단, 계정 생성 안내
- 네트워크 에러: 재시도 버튼 표시
- Webhook 실패: 백그라운드에서 재시도, 사용자 플로우는 계속 진행

---

### 1.2 재방문 사용자 (가입 완료)

#### 시나리오 A: 과거 결과 재확인

##### 입력
- 홈페이지 또는 직접 대시보드 URL 접속
- 이력 카드 클릭

##### 처리
1. 사용자가 URL 접속
2. 시스템이 Clerk 세션 확인
3. 유효한 세션 존재 확인
4. 대시보드 페이지 렌더링
5. Supabase에서 사용자 ID로 사주분석 이력 조회
6. created_at 기준 내림차순 정렬
7. 이력 카드 목록 렌더링
8. 사용자가 특정 카드 클릭
9. 해당 분석 ID로 상세 페이지 이동

##### 출력
- 대시보드 페이지 표시
- 사주분석 이력 카드 목록 표시
- 선택한 분석 상세 페이지 표시

##### 엣지케이스
- 세션 만료: Clerk 자동 로그인 페이지 리다이렉트
- 이력 없음: 빈 상태 화면 표시
- 데이터베이스 연결 실패: 에러 메시지 및 재시도 버튼
- 이력 데이터 손상: 해당 카드만 에러 표시, 나머지는 정상 렌더링

---

#### 시나리오 B: 새 분석 요청

##### 입력
- 대시보드에서 새 검사하기 버튼 클릭
- 분석 폼 입력
- 검사 시작 버튼 클릭

##### 처리
1. 사용자가 새 검사하기 버튼 클릭
2. 시스템이 인증 상태 재확인
3. 새 검사하기 페이지로 이동
4. 빈 폼 렌더링
5. 사용자가 필수 항목 입력
6. 실시간 클라이언트 측 검증 수행
7. 모든 필수 항목 입력 시 검사 시작 버튼 활성화
8. 사용자가 검사 시작 클릭
9. 서버 액션 호출
10. Gemini API에 분석 요청
11. AI 응답 대기
12. 응답 파싱 및 검증
13. Supabase saju_tests 테이블에 저장
14. 새 분석 ID 반환
15. 상세 페이지로 리다이렉트

##### 출력
- 새 검사하기 페이지 표시
- 입력 폼 렌더링
- 로딩 스피너 표시
- 분석 완료 후 상세 페이지로 이동

##### 엣지케이스
- 폼 검증 실패: 해당 필드 아래 에러 메시지 표시
- AI API 타임아웃: 에러 메시지 및 재시도 버튼
- 데이터베이스 저장 실패: 에러 메시지, 재시도 버튼
- 세션 만료: 입력 데이터 로컬 스토리지에 임시 저장, 로그인 페이지로 리다이렉트

---

## 2. 회원가입/로그인 플로우

### 2.1 로그인 플로우

#### 입력
- 시작하기 또는 이용하기 버튼 클릭
- 또는 보호된 페이지 직접 접근 시도

#### 처리
1. 사용자가 CTA 버튼 클릭 또는 보호된 URL 접근
2. 시스템이 Clerk 세션 확인
3. 세션 없음 감지
4. 현재 URL을 returnUrl 파라미터로 저장
5. Clerk SignIn 컴포넌트로 리다이렉트
6. Clerk가 로그인 페이지 렌더링
7. Google 로그인 버튼 표시
8. 사용자가 Google 로그인 선택
9. Google OAuth 동의 화면 표시
10. 사용자가 동의 및 계정 선택
11. Google이 인증 코드 반환
12. Clerk가 JWT 토큰 생성 및 세션 생성
13. returnUrl로 리다이렉트 (없으면 대시보드로)

#### 출력
- Clerk 로그인 페이지 표시
- Google OAuth 동의 화면
- 로그인 성공 시 원래 목적지 페이지로 이동

#### 엣지케이스
- Google 계정 선택 취소: 로그인 페이지로 복귀
- OAuth 권한 거부: 에러 메시지 표시
- 네트워크 단절: 재시도 안내 메시지
- 다른 OAuth 제공자 클릭: 지원하지 않음 메시지

---

### 2.2 자동 회원가입 플로우

#### 입력
- 최초 Google 로그인 시도

#### 처리
1. 사용자가 Google 로그인 선택
2. Google OAuth 인증 완료
3. Clerk가 해당 이메일 계정 조회
4. 기존 계정 없음 확인
5. Clerk가 자동으로 신규 계정 생성
6. user.created Webhook 이벤트 발행
7. 배포된 웹훅 엔드포인트로 POST 요청
8. 서버가 Webhook 검증
9. 사용자 정보 추출 (id, email, name)
10. Supabase users 테이블에 INSERT
11. 생성 완료 응답 반환
12. Clerk 세션 생성
13. 대시보드로 리다이렉트

#### 출력
- 회원가입 완료
- 대시보드 페이지 표시
- 빈 상태 안내

#### 엣지케이스
- Webhook 엔드포인트 접근 불가: 재시도 큐에 추가
- Supabase 연결 실패: 에러 로깅, 재시도
- 중복 이메일 (동시 요청): UNIQUE 제약으로 방지, 첫 요청만 성공
- Webhook 서명 검증 실패: 요청 거부, 로그 기록

---

### 2.3 로그아웃 플로우

#### 입력
- UserButton에서 로그아웃 선택

#### 처리
1. 사용자가 UserButton 클릭
2. Clerk 메뉴 표시
3. 로그아웃 옵션 클릭
4. Clerk가 세션 무효화
5. JWT 토큰 삭제
6. 브라우저 쿠키 삭제
7. 홈페이지로 리다이렉트

#### 출력
- 로그아웃 완료
- 홈페이지 표시
- 시작하기 버튼 표시

#### 엣지케이스
- 네트워크 에러: 로컬 세션만 삭제, 백그라운드에서 서버 세션 무효화 재시도
- 이미 만료된 세션: 정상 처리, 홈으로 리다이렉트

---

## 3. 새 사주분석 요청 플로우

### 3.1 폼 입력 및 검증

#### 입력
- 성함 텍스트 입력
- 생년월일 선택 또는 입력
- 출생시간 선택 또는 입력
- 출생시간 모름 체크박스
- 성별 선택

#### 처리
1. 사용자가 새 검사하기 페이지 접속
2. 시스템이 빈 폼 렌더링
3. 각 필드가 onChange 이벤트 리스너 등록

**성함 입력:**
4. 사용자가 성함 필드에 입력
5. 실시간으로 길이 검증 (1-50자)
6. 유효성 상태 업데이트
7. 에러 있으면 필드 아래 메시지 표시

**생년월일 입력:**
8. 사용자가 DatePicker 클릭 또는 직접 입력
9. 날짜 형식 검증 (YYYY-MM-DD)
10. 범위 검증 (1900-01-01 ~ 오늘)
11. 유효성 상태 업데이트
12. 에러 있으면 필드 아래 메시지 표시

**출생시간 입력:**
13. 사용자가 TimePicker 클릭 또는 직접 입력
14. 시간 형식 검증 (HH:mm)
15. 출생시간 모름 체크박스 클릭 시:
    - 시간 입력 필드 비활성화
    - 값 null로 설정
16. 체크박스 해제 시:
    - 시간 입력 필드 활성화

**성별 선택:**
17. 사용자가 라디오 버튼 클릭
18. 선택 값 상태에 저장

**전체 검증:**
19. 모든 필수 필드 입력 상태 체크
20. 모든 필드 유효성 체크
21. 조건 충족 시 검사 시작 버튼 활성화
22. 조건 미충족 시 버튼 비활성화 유지

#### 출력
- 각 필드별 실시간 검증 결과
- 에러 메시지 (필요 시)
- 검사 시작 버튼 활성화 상태 변경

#### 엣지케이스
- 복사/붙여넣기 데이터: 붙여넣기 후 검증 수행
- 날짜 수동 입력 시 잘못된 형식: 에러 메시지 표시
- 미래 날짜 입력: 오늘 이전만 허용 메시지
- 1900년 이전 날짜: 1900년 이후만 허용 메시지
- 출생시간 모름 체크 후 체크 해제: 필드 재활성화, 값 유지되지 않음

---

### 3.2 분석 실행

#### 입력
- 검사 시작 버튼 클릭

#### 처리
1. 사용자가 검사 시작 버튼 클릭
2. 폼 데이터 최종 검증
3. 검사 시작 버튼 비활성화
4. 로딩 스피너 표시
5. 서버 액션 함수 호출
6. 서버에서 사용자 인증 상태 재확인
7. 입력 데이터 서버 측 검증
8. 시스템 프롬프트 생성:
   - 입력 데이터 포맷팅
   - 프롬프트 템플릿에 값 삽입
9. Gemini API 호출:
   - API 키 헤더 추가
   - 프롬프트 전송
   - 스트리밍 또는 일괄 응답 대기
10. AI 응답 수신
11. 마크다운 형식 검증
12. 응답 텍스트 파싱
13. Supabase에 저장:
    - user_id: 현재 사용자 ID
    - name: 입력한 성함
    - birth_date: 생년월일
    - birth_time: 출생시간 (nullable)
    - gender: 성별
    - result: AI 분석 결과
    - created_at: 현재 시각
14. 저장된 레코드 ID 반환
15. 상세 페이지로 리다이렉트

#### 출력
- 로딩 스피너 (10-30초)
- 분석 완료 후 상세 페이지로 자동 이동

#### 엣지케이스
- API 호출 실패: 에러 메시지 토스트, 재시도 버튼 활성화
- 타임아웃 (60초 초과): 타임아웃 메시지, 재시도 안내
- 네트워크 단절: 연결 에러 메시지, 재시도 버튼
- 응답 형식 불일치: 파싱 에러 처리, 재시도 또는 관리자 알림
- 데이터베이스 저장 실패: 에러 메시지, 재시도 버튼
- 세션 만료: 입력 데이터 임시 저장, 로그인 페이지로 리다이렉트
- 동시 다중 요청 방지: 버튼 비활성화, 진행 중 표시

---

### 3.3 분석 완료 및 이동

#### 입력
- 분석 완료 및 저장 성공

#### 처리
1. 서버 액션이 분석 ID 반환
2. 클라이언트가 ID 수신
3. 로딩 상태 종료
4. router.push로 상세 페이지 이동
5. URL에 분석 ID 포함
6. 상세 페이지 컴포넌트 마운트
7. 해당 ID로 데이터 조회

#### 출력
- 사주분석 상세 페이지 표시
- 분석 결과 렌더링

#### 엣지케이스
- 리다이렉트 실패: 수동 링크 제공
- ID 누락: 대시보드로 이동, 최신 분석 표시

---

## 4. 사주분석 이력 조회 플로우

### 4.1 대시보드 접근

#### 입력
- 대시보드 URL 접속
- 또는 네비게이션 메뉴에서 대시보드 클릭

#### 처리
1. 사용자가 대시보드 접근
2. 시스템이 Clerk 세션 확인
3. 인증 상태 검증
4. 대시보드 페이지 컴포넌트 렌더링
5. 서버 컴포넌트에서 데이터 페칭:
   - 현재 사용자 ID 추출
   - Supabase saju_tests 테이블 쿼리
   - WHERE user_id = current_user_id
   - ORDER BY created_at DESC
   - LIMIT 10 (페이지네이션)
6. 데이터 반환
7. 클라이언트 컴포넌트로 props 전달
8. 이력 카드 목록 렌더링

#### 출력
- 대시보드 페이지 표시
- 사주분석 이력 카드 목록
- 각 카드에 이름, 생년월일, 성별, 날짜, 미리보기 표시

#### 엣지케이스
- 비로그인 상태: 로그인 페이지로 리다이렉트
- 이력 없음: 빈 상태 화면, 첫 검사 시작하기 버튼
- 데이터베이스 연결 실패: 에러 메시지, 재시도 버튼
- 느린 쿼리: 스켈레톤 로딩 표시
- 10개 이상 이력: 페이지네이션 또는 더보기 버튼

---

### 4.2 이력 필터링 및 정렬

#### 입력
- 이력 목록 스크롤
- 더보기 버튼 클릭 (10개 이상 시)

#### 처리
1. 사용자가 스크롤 또는 더보기 클릭
2. 추가 데이터 페칭 요청
3. OFFSET 값 증가 (10, 20, 30...)
4. Supabase 쿼리 실행
5. 추가 이력 데이터 반환
6. 기존 목록에 append
7. 카드 렌더링

#### 출력
- 추가 이력 카드 표시
- 스크롤 위치 유지

#### 엣지케이스
- 더 이상 데이터 없음: 더보기 버튼 숨김
- 중복 요청 방지: 로딩 중 버튼 비활성화
- 네트워크 에러: 에러 메시지, 재시도 버튼

---

### 4.3 이력 카드 클릭

#### 입력
- 특정 이력 카드 클릭

#### 처리
1. 사용자가 카드 클릭
2. 카드의 data-id 속성에서 분석 ID 추출
3. router.push로 상세 페이지 이동
4. URL 파라미터에 ID 포함
5. 상세 페이지 렌더링

#### 출력
- 해당 분석 상세 페이지로 이동

#### 엣지케이스
- ID 없음: 대시보드에서 에러 메시지
- 잘못된 ID: 404 페이지 또는 대시보드로 리다이렉트

---

## 5. 사주분석 상세 조회 플로우

### 5.1 상세 페이지 접근

#### 입력
- 상세 페이지 URL 접근
- 또는 이력 카드 클릭

#### 처리
1. 사용자가 URL 접근
2. Next.js가 동적 라우트 파라미터 파싱
3. 분석 ID 추출
4. 시스템이 Clerk 세션 확인
5. 서버 컴포넌트에서 데이터 페칭:
   - Supabase saju_tests 테이블 쿼리
   - WHERE id = analysis_id AND user_id = current_user_id
6. 데이터 존재 여부 확인
7. 권한 검증 (본인 분석인지)
8. 데이터 반환
9. 상세 페이지 렌더링:
   - 분석 대상 정보 카드
   - 마크다운 결과 렌더링
   - 액션 버튼

#### 출력
- 사주분석 상세 페이지
- 분석 대상 정보 (이름, 생년월일, 출생시간, 성별, 분석 날짜)
- 마크다운으로 렌더링된 분석 결과
- 목록으로, 새 검사하기, 결과 복사 버튼

#### 엣지케이스
- 비로그인 상태: 로그인 페이지로 리다이렉트
- 존재하지 않는 ID: 404 페이지
- 다른 사용자의 분석 접근 시도: 404 또는 권한 없음 메시지
- 데이터베이스 연결 실패: 에러 메시지, 재시도 버튼
- 마크다운 파싱 에러: 원본 텍스트 표시

---

### 5.2 결과 복사

#### 입력
- 결과 복사 버튼 클릭

#### 처리
1. 사용자가 결과 복사 버튼 클릭
2. 분석 결과 텍스트 (마크다운) 추출
3. navigator.clipboard.writeText() 호출
4. 클립보드에 텍스트 복사
5. 성공 시 토스트 메시지 표시
6. 버튼 아이콘 변경 (체크 표시)
7. 2초 후 원래 아이콘으로 복구

#### 출력
- 클립보드에 마크다운 텍스트 복사
- 복사 완료 토스트 메시지

#### 엣지케이스
- 클립보드 API 미지원 브라우저: 폴백 메서드 사용 (textarea 생성, 복사, 삭제)
- 복사 실패: 에러 토스트 메시지
- 권한 거부 (HTTPS 아님): 권한 요청 또는 안내 메시지

---

### 5.3 네비게이션

#### 입력
- 목록으로 버튼 클릭
- 또는 새 검사하기 버튼 클릭

#### 처리
**목록으로:**
1. 사용자가 목록으로 버튼 클릭
2. router.push로 대시보드 이동
3. 대시보드 렌더링

**새 검사하기:**
1. 사용자가 새 검사하기 버튼 클릭
2. router.push로 새 검사 페이지 이동
3. 빈 폼 렌더링

#### 출력
- 해당 페이지로 이동

#### 엣지케이스
- 네비게이션 중 에러: 브라우저 뒤로가기 사용 안내

---

## 6. 예외 상황 및 에러 처리

### 6.1 인증 관련 에러

#### 6.1.1 세션 만료

**발생 시점:**
- 보호된 페이지 접근 중
- API 호출 중

**처리:**
1. 미들웨어가 세션 만료 감지
2. 현재 URL을 returnUrl로 저장
3. Clerk 로그인 페이지로 리다이렉트
4. 재로그인 후 원래 페이지로 복귀

**사용자 경험:**
- 로그인 페이지로 자동 이동
- 재로그인 후 원래 작업 위치로 복귀

---

#### 6.1.2 권한 없음

**발생 시점:**
- 다른 사용자의 분석 접근 시도

**처리:**
1. 서버 컴포넌트에서 user_id 불일치 감지
2. 404 페이지 렌더링
3. 또는 대시보드로 리다이렉트

**사용자 경험:**
- 404 페이지 표시
- 대시보드로 돌아가기 버튼

---

### 6.2 API 관련 에러

#### 6.2.1 Gemini API 실패

**발생 원인:**
- API 키 만료 또는 잘못됨
- 할당량 초과
- 서비스 장애

**처리:**
1. API 호출 시 try-catch 블록
2. 에러 코드 확인
3. 사용자에게 적절한 메시지 표시
4. 1회 재시도 시도
5. 재시도 실패 시 최종 에러 메시지

**사용자 경험:**
- 에러 토스트 메시지
- 재시도 버튼 제공
- 또는 대시보드로 돌아가기

**에러 메시지 예시:**
- API 키 오류: 시스템 오류, 관리자에게 문의
- 할당량 초과: 일시적으로 서비스 이용 불가, 나중에 재시도
- 타임아웃: 요청 시간 초과, 다시 시도

---

#### 6.2.2 API 타임아웃

**발생 조건:**
- 60초 내 응답 없음

**처리:**
1. 서버 액션에서 타임아웃 설정
2. 60초 경과 시 요청 중단
3. 타임아웃 에러 throw
4. 클라이언트에서 에러 캐치
5. 타임아웃 메시지 표시

**사용자 경험:**
- 타임아웃 안내 메시지
- 재시도 버튼

---

### 6.3 데이터베이스 관련 에러

#### 6.3.1 연결 실패

**발생 원인:**
- 네트워크 문제
- Supabase 서비스 장애
- 잘못된 연결 설정

**처리:**
1. 쿼리 실행 시 try-catch
2. 연결 에러 감지
3. 재시도 로직 (최대 3회)
4. 실패 시 에러 메시지

**사용자 경험:**
- 스켈레톤 로딩 (시도 중)
- 에러 메시지 및 재시도 버튼

---

#### 6.3.2 데이터 저장 실패

**발생 원인:**
- 제약 조건 위반
- 네트워크 에러
- 권한 문제

**처리:**
1. INSERT 실행 시 try-catch
2. 에러 코드 확인
3. 적절한 에러 메시지 생성
4. 사용자에게 전달

**사용자 경험:**
- 에러 토스트 메시지
- 재시도 버튼 또는 대시보드로 돌아가기

---

### 6.4 클라이언트 측 에러

#### 6.4.1 폼 검증 실패

**발생 조건:**
- 필수 항목 미입력
- 잘못된 형식

**처리:**
1. 각 필드별 실시간 검증
2. 에러 상태 업데이트
3. 에러 메시지 렌더링
4. 제출 버튼 비활성화 유지

**사용자 경험:**
- 필드 아래 에러 메시지 표시
- 필드 테두리 빨간색
- 제출 버튼 비활성화

**에러 메시지 예시:**
- 성함 미입력: 성함을 입력해주세요
- 생년월일 형식 오류: 올바른 날짜를 입력해주세요 (YYYY-MM-DD)
- 미래 날짜: 생년월일은 오늘 이전이어야 합니다
- 성별 미선택: 성별을 선택해주세요

---

#### 6.4.2 네트워크 에러

**발생 조건:**
- 인터넷 연결 끊김
- 서버 응답 없음

**처리:**
1. API 호출 시 네트워크 에러 캐치
2. 연결 상태 확인
3. 적절한 메시지 표시

**사용자 경험:**
- 네트워크 연결 확인 안내
- 재시도 버튼
- 오프라인 표시

---

### 6.5 Webhook 관련 에러

#### 6.5.1 Webhook 전송 실패

**발생 원인:**
- 배포 환경 엔드포인트 접근 불가
- 서버 오류

**처리:**
1. Clerk가 자동 재시도 (exponential backoff)
2. 서버 측 로그 기록
3. 최대 재시도 후 실패 시 수동 동기화

**사용자 경험:**
- 사용자는 인지하지 못함
- Clerk 세션은 정상 작동
- Supabase 데이터는 백그라운드에서 동기화

---

#### 6.5.2 Webhook 검증 실패

**발생 원인:**
- 잘못된 서명
- 만료된 요청
- 악의적인 요청

**처리:**
1. 서버에서 Clerk 서명 검증
2. 검증 실패 시 요청 거부
3. 에러 로그 기록
4. 400 응답 반환

**사용자 경험:**
- 사용자는 인지하지 못함
- 보안 강화

---

### 6.6 페이지별 에러 처리 요약

#### 홈페이지
- 네트워크 에러: 정적 컨텐츠 표시 유지
- 로그인 버튼 클릭 실패: 에러 메시지 및 재시도

#### 대시보드
- 데이터 로딩 실패: 에러 메시지, 재시도 버튼
- 빈 상태: 첫 검사 시작하기 버튼
- 세션 만료: 로그인 페이지로 리다이렉트

#### 새 검사하기
- 폼 검증 실패: 필드별 에러 메시지
- API 호출 실패: 에러 토스트, 재시도 버튼
- 타임아웃: 타임아웃 메시지, 재시도 안내
- 세션 만료: 입력 데이터 임시 저장, 로그인 페이지로

#### 사주분석 상세
- 존재하지 않는 ID: 404 페이지
- 권한 없음: 404 또는 대시보드로 리다이렉트
- 데이터 로딩 실패: 에러 메시지, 대시보드로 돌아가기
- 마크다운 렌더링 실패: 원본 텍스트 표시

---

## 7. 성능 최적화 관련 플로우

### 7.1 페이지 로딩 최적화

**처리:**
1. Next.js App Router 서버 컴포넌트 활용
2. 정적 컨텐츠 사전 렌더링
3. 동적 데이터만 클라이언트 측 페칭
4. 이미지 최적화 (Next.js Image)
5. 코드 스플리팅 자동 적용
6. Vercel Edge Network 캐싱

**사용자 경험:**
- 빠른 초기 페이지 로드
- 부드러운 페이지 전환

---

### 7.2 데이터 페칭 최적화

**처리:**
1. 서버 컴포넌트에서 데이터 페칭
2. 필요한 컬럼만 SELECT
3. 인덱스 활용 쿼리 최적화
4. 페이지네이션으로 대량 데이터 방지
5. React Suspense 활용 스트리밍

**사용자 경험:**
- 빠른 데이터 로딩
- 스켈레톤 로딩으로 UX 개선

---

### 7.3 AI 분석 대기 UX

**처리:**
1. 검사 시작 클릭 시 즉시 로딩 표시
2. 프로그레스 바 또는 스피너 렌더링
3. 예상 대기 시간 안내
4. 백그라운드에서 API 호출
5. 완료 시 자동 페이지 전환

**사용자 경험:**
- 명확한 로딩 상태 표시
- 예상 시간 안내로 불안감 감소
- 자동 전환으로 편의성 향상

---

## 8. 접근성 관련 플로우

### 8.1 키보드 네비게이션

**지원 기능:**
- Tab 키로 모든 인터랙티브 요소 접근
- Enter/Space 키로 버튼 활성화
- Esc 키로 모달 닫기
- 포커스 표시 명확화

---

### 8.2 스크린 리더 지원

**구현 사항:**
- 의미 있는 ARIA 라벨
- role 속성 명시
- 에러 메시지에 aria-live 적용
- 로딩 상태 aria-busy 표시

---

## 9. 모바일 대응 플로우

### 9.1 반응형 레이아웃

**처리:**
- 320px 이상 모든 화면 크기 지원
- 터치 친화적 버튼 크기 (최소 44x44px)
- 스와이프 제스처 지원 (카드 네비게이션)
- 모바일 최적화 폼 입력

**사용자 경험:**
- 모든 디바이스에서 일관된 경험
- 터치 조작 편의성

---

## 10. 보안 관련 플로우

### 10.1 XSS 방지

**처리:**
- React 자동 이스케이프 활용
- 마크다운 렌더러에 sanitize 적용
- 사용자 입력 검증 및 필터링

---

### 10.2 CSRF 방지

**처리:**
- Clerk JWT 기반 인증
- 서버 액션에서 토큰 검증
- SameSite 쿠키 설정

---

### 10.3 데이터 접근 제어

**처리:**
- RLS (Row Level Security) 적용
- 서버 컴포넌트에서 user_id 검증
- 본인 데이터만 접근 허용

---

## 문서 이력

| 버전 | 날짜 | 작성자 | 변경 내역 |
|------|------|--------|----------|
| 1.0 | 2025-10-27 | Claude Code | 초안 작성 |
