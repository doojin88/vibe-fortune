# 👊 [3주차] #2 - 구독제 사주분석 서비스

## 가이드

1. SuperNext를 사용해서 Next.js 프로젝트를 만들어주세요.
2. 완성된 결과물을 Vercel에 배포해주세요.

3. 완성된 결과물을 GitHub에 업로드해주세요.


## 도전 과제

다음 기능을 Clerk, Supabase, 토스페이먼츠를 연동하여 구현한 뒤 배포하라.

---

## ▼ ✅ 통과 조건

### • 아래 기능이 오류 없이 연동된다.

- 인증(Google 로그인)
- 토스페이먼츠 구독결제
- Gemini API 기반 사주분석

### • 포함 페이지

홈 이외의 페이지는 인증 상태로만 접근 가능합니다.

인증관련 페이지는 모두 Clerk SDK에서 기본적으로 제공되는 것을 사용합니다.

- 홈 (랜딩페이지)
- 대시보드 (사주분석목록)
- 새 사주분석하기
- 사주분석 상세보기
- 구독 관리

### • 구독 정책

- 무료 가입 유저는 최초 3회만 테스트 가능합니다. (`gemini-2.5-flash` 사용)
- Pro 요금제 구독 고객은 월 10회 테스트 가능합니다. (`gemini-2.5-pro` 사용)
- Pro 요금제 취소 시, 다음 결제일까지 구독 상태가 유지됩니다.
- Pro 요금제 취소 시, 다음 결제일전에 취소상태를 취소할 수 있습니다.
- 구독 해지와 동시에 빌링키를 삭제합니다. 다시 구독하려면 SDK를 통한 재발급이 필요합니다.

---

## ▼ ❌ 통과/평가 조건이 아닌 것

다음 항목은 자유롭게 진행하셔도 괜찮습니다.

• 미리보기와 동일한 디자인 및 문구를 사용하여 구현한다.

• 그 외 통과조건에 언급되지 않은 모든 요소

---

## ▼ 🍯 꿀 TIP

### • Clerk SDK/Webhook을 사용해야합니다.

### • Clerk Webhook은 서비스가 배포된 상태에서만 작동합니다!

### • 사주분석 시스템 프롬프트 예시를 첨부합니다. 더 고도화하셔도 괜찮습니다.

**▼ 펼쳐보기**

```typescript
import type { TestInput } from '@/types/test';

export const generateSajuPrompt = (input: TestInput): string => {
  return `당신은 20년 경력의 전문 사주팔자 상담사입니다.

**입력 정보**:
- 성함: ${input.name}
- 생년월일: ${input.birthDate}
- 출생시간: ${input.birthTime || '미상'}
- 성별: ${input.gender === 'male' ? '남성' : '여성'}

**분석 요구사항**:
1️⃣ 천간(天干)과 지지(地支) 계산
2️⃣ 오행(五行) 분석 (목, 화, 토, 금, 수)
3️⃣ 대운(大運)과 세운(歲運) 해석
4️⃣ 전반적인 성격, 재운, 건강운, 연애운 분석

**출력 형식**: 마크다운

**금지 사항**:
- 의료·법률 조언
- 확정적 미래 예측
- 부정적·공격적 표현`;
};
```

### • 정기결제 trigger에 Supabase cron을 사용하세요.

**작동 플로우**

1. [Supabase cron] 매일 02:00에 trigger, Next.js API 호출
2. [Next.js API] 유효한 호출인지 검증
3. [Next.js API] 오늘이 결제일인 구독건들 탐색 후 하나하나 결제API 호출
